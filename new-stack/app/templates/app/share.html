{% extends "app/layout.html" %}

{% block content %}

<div style="margin-right:110px" align="right">
    <form method="GET" style="display: inline-block; margin: 12px;" action="{% url 'search' %}">
                <input style="width:200px;" type="search" value="{{request.GET.q}}" placeholder="Search articles by keyword" name="search">
                <button type="submit">Submit</button>
    </form>
</div>

<div class="jumbotron" style="background-color:transparent; height:550px">
    <div class="front-door-banner">
        <h1 class="front-door-banner__header">NEWS YOU CAN TRUST</h1>
        <h2 class="front-door-banner__subheader">Politics on the rise</h2>
        {% if not user.is_authenticated %}
        <p style="text-align: center"><a href="{% url 'register' %}" class="btn
                btn-primary btn-large">Sign Up</a></p>
        {% endif %}
    </div>
</div>

<hr/>

    <div class="grid">
  
        {% for list in Article %}
        {% for article in list %}
        <div id="card{{article.id}}" class="card" style="position:relative;">
            <img id="myImg{{article.id}}" class="urlImage"
                src={{article.urlImage}} />
            <h4 id="title{{article.id}}" style="font-weight:bold"> {{article.title}}</h4>
            <p>{{article.description}}</p>

            {% for shareInfo in share %}
            {% if shareInfo.article_id == article.id  %}
                <h4>Shared by {{shareInfo.sentFrom}}</h4>
            {% endif %}
            {%endfor%}
            <div class="overlay">
                {% if user.is_authenticated %}
                        <form method="GET" action="{% url 'save' %}" style="float: left; clear: right; margin-right: 2px;">
                            <input type="hidden" value="{{article.id}}" name="article">
                            <button type="submit">save</button>
                        </form>
                        
                        <form method="GET" action="{% url 'share' %}" style="float: right;">
                            <input type="hidden" value="{{article.id}}" name="shareArticle">
                            <button type="submit">share</button>
                            <input style="width: 100px;" type="search" value="{{request.GET.q}}" placeholder="Username" name="username">
                        </form>
                {% endif %}
            </div>
        </div>



        <div id={{article.id}} class="modal">
            <div class="wrapper">
                <h5 id="modalTitle{{article.id}}" class="title-content"></h5>
                <div class="image-content">
                    <img class="articleimage-content" id="img{{article.id}}">  
                    <img class="graph" id="sentiment{{article.id}}" src="">
                </div> 
                <div class="paragraph-content">
                    <h4 style="margin:75px;text-align: justify;font-family:'Times New Roman', Times, serif" 
                        id="text{{article.id}}"></h4>
                </div>
            <div>
                    <ul class="source">
                        <li> <h5 id="reference{{article.id}}"></h5> </li>
                        <li> <div> <a id="url{{article.id}}" target="_blank"
                                    text-decoration:" none" href="">Source</a>
                            </div></li>
                        <li> <h5 id="published{{article.id}}"></h5> </li>
                    </ul>
                </div>
            </div>
        </div>

        <script>
            var modal = document.getElementById('{{article.id}}');
            var modalImg = document.getElementById('img{{article.id}}');
            var img = document.getElementById('myImg{{article.id}}');
            img.style.cursor = "pointer";
            var content = document.getElementById('text{{article.id}}');
            var author = document.getElementById('reference{{article.id}}');
            var title = document.getElementById('modalTitle{{article.id}}');
            var url = document.getElementById('url{{article.id}}');
            var published = document.getElementById('published{{article.id}}');
            var sentimentNeg = document.getElementById('sentimentNeg{{article.id}}');
            var sentimentNeu = document.getElementById('sentimentNeu{{article.id}}');
            var sentimentPos = document.getElementById('sentimentPos{{article.id}}');
            var sentiment = document.getElementById('sentiment{{article.id}}');
            
            img.onclick = function(){
                 var str = "";
                 str = '{{article.text}}';
                 var sentences = [];
                 sentences = str.replace(/([.?!])\s*(?=[A-Z])/g, "$1|").split("|");    

                modal.style.display = "block";
                modalImg.src = '{{article.urlImage}}';
                title.innerHTML = '{{article.title}}';
            
                content.innerHTML = "";
                
                var similarity;
                var urlFact;
                if(content.childElementCount == 0){
                    for(var i = 0; i < sentences.length; i++){
                        var temp = i;
                        var temp2;
                        similarity = 0;


                        {% for fact in factCheck %}
                            {% if fact.article.id == article.id %}
                                  temp2 = '{{fact.sentenceNumber}}';
                                if(temp == temp2){
                                    similarity = '{{fact.similarityPercentage}}';
                                    urlFact = document.createElement('a');
                                    urlFact.setAttribute("href", '{{fact.URLFact}}');
                                }
                            {% endif %}
                        {% endfor %}
                        
                        var txt = sentences[i];
                        txt = txt.replace("[", "");
                        txt = txt.replace("]", "");
                        var sentence = null;        
                        sentence = document.createElement('span');
                        sentence.id = '{{artcle.id}}' + i;
                        if(similarity > 0.20){
                            sentence.style = "color:green;font-weight:bold";
                            sentence.style.cursor = "pointer";
                            urlFact.innerHTML = txt + " " + "[" + similarity + "]" + " ";
                            sentence.append(urlFact);       
                        }
                        else{
                            sentence.innerHTML = txt + " ";
                        }
                        content.append(sentence);
                     }
                   }

                
                author.innerHTML = 'Author:'+' {{article.author}}';

                url.setAttribute("href",'{{article.url}}');
                url.innerHTML = '{{article.source}}';
                published.innerHTML = 'Published On:'+' {{article.publishedOn}}';
                sentiment.src="/static/app/img/{{article.id}}.png";
            }
            
            window.onclick = function(event){
                if (event.target == modal){
                    modal.style.display = "none";
                }
            }
        </script>

        {%endfor%}
        {%endfor%}
    </div>


    {% endblock %}